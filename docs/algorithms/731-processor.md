# ABT-7.3.1-Processor: 오류 정정 알고리즘 v1.1

### 🔗 KWCAG 2.2 Reference
- **7.3.1 (오류 정정)**: 입력 오류를 정정할 수 있는 방법을 제공해야 한다.

---

이 알고리즘은 **KWCAG 7.3.1(오류 정정)** 지침을 준수하며, 사용자가 입력 서식(Form)을 작성하는 과정에서 오류가 발생했을 때, 그 원인을 명확히 안내하고 정정할 수 있는 수단을 제공하는지 진단한다. 

> 💡 **브라우저 확장 프로그램(ABT 엔진)의 테스트 제약 및 전략**
> 확장 프로그램은 결제, 탈퇴 등 실제 서버 전송을 유발할 수 있으므로 **프로그램에 의한 자동 폼 전송(Submit 클릭 등)을 금지**한다. 대신 다음의 **패시브 옵저버(Passive Observer) 및 정적 분석 모델**을 결합하여 검증한다.

## 1. 대상 식별 및 데이터 수집 (Data Collection)

### [대상 요소 추출]
- **입력 서식 요소**: `<form>`, `<input>`, `<select>`, `<textarea>`, `[role="textbox"]` 등
- **오류 정보 제공 요소**: `aria-invalid="true"`, `aria-errormessage`, `aria-describedby`, `role="alert"`, `aria-live="assertive"`가 적용된 텍스트 컨테이너
- **이벤트 트리거**: 서식 제출(Submit) 버튼 및 유효성 검사(Validation) 관련 스크립트 이벤트 (`onsubmit`, `onblur`, `invalid` 등)

## 2. 분석 및 분류 로직 (Analysis Pipeline)

제공된 KWCAG 2.2의 4가지 주요 오류 유형과 예외 사항을 기반으로 분석을 수행한다.

### [단계 A] 정적 방어 코드 및 HTML5 검증 (안전한 자동 검사)
- **분석 로직**: 
  - 폼 요소에 `required`, `pattern`, `type="email"` 등의 HTML5 제약 조건이 설정되어 있는지 정적 분석.
  - 브라우저 네이티브 API인 `form.checkValidity()`를 백그라운드에서 호출하여 **실제 전송 없이** 입력값 누락이나 타입 오류 필드를 식별.
  - `aria-invalid="true"`가 설정된 요소에 `aria-errormessage`나 `aria-describedby`가 연결되어 구체적인 오류 텍스트를 제공하는지 검사.
- **결과**: 오류 메시지 제공을 위한 구조적 연결고리가 없으면 **[수정 권고]**.

### [단계 B] 전문가 수동 유발 및 패시브 옵저버 추적 (오류 유형 1, 2, 3)
- **분석 로직**: 
  - 엔진은 페이지 로드 시 전역 `invalid` 및 `submit` 이벤트 리스너를 주입해 둔다(Passive Observer).
  - 전문가(사용자)가 고의로 양식을 비우거나 잘못된 값을 넣고 **수동으로 제출 버튼을 클릭**하여 에러를 유발한다.
  - 에러가 트리거된 직후 1초 내에 다음을 추적한다:
    1. 화면에 `role="alert"` 등으로 오류 텍스트가 동적으로 렌더링되었는가? (유형 1, 2)
    2. 브라우저의 초점(`document.activeElement`)이 에러가 발생한 `<input>` 서식으로 자동 이동하였는가? (유형 3)
- **결과**: 전문가 유발 테스트에서 초점 이동 실패나 안내 텍스트 부재가 관측되면 **[부적절]**.

### [단계 C] 입력 데이터 유지 여부 검사 (오류 유형 4)
- **분석 로직**: 폼 제출 시도 전(Before Submit) 확장 프로그램 메모리에 폼의 모든 `value` 상태를 임시 저장한다.
- 폼 제출에 실패하여 페이지가 새로고침되거나 에러를 뱉어낸 직후, 기존 저장된 데이터와 현재 화면의 `value`를 대조한다.
- **결과**: 오류 발생 후 폼의 내용이 모두 초기화되어 사라지면 **[부적절]**.

### [단계 D] 외부 시스템 검증 예외 (예외 사항 처리)
- 은행 뱅킹의 계좌 확인, 인증서 검증, 결제망 승인 등 "이미 전송된 값에 대해 외부 시스템으로부터 처리 가능 여부를 검증받는 경우"는 본 지침의 오류 정정 대상에서 제외한다.
- 단, 클라이언트 단에서 검증 가능한 "값의 누락, 형식(이메일 패턴 등), 범위의 유효성" 오류는 반드시 정정 방법을 제공해야 한다.
- 결과: 외부 서버 응답에 의존하는 오류는 **[해당 없음(예외)]** 처리하고, 프론트엔드 유효성 검증 위주로 평가한다.

## 3. 최종 상태 정의 (Final Status)
1. **부적절 (Warning):**
   - 입력 오류 발생 시 원인/내용을 설명 텍스트로 알려주지 않는 경우.
   - 오류 정보 확인 시(또는 팝업 닫기 시) 해당 입력 서식으로 초점이 이동하지 않는 경우.
   - 입력 오류 발생 시 기존에 입력한 내용이 모두 초기화(리셋)되어 사라지는 경우.
2. **검토 필요 (Review):**
   - 폼 입력란과 제출 버튼이 감지되어 정적 분석(단계 A)은 통과했으나, 실제 동작(초점 이동 등)에 대해 전문가의 수동 유발 테스트(단계 B)가 아직 진행되지 않은 상태.
3. **적절 (Pass):**
   - 전문가가 유도한 에러 상황에서 명확한 텍스트로 안내하고, 초점이 해당 필드로 이동하며, 입력한 데이터가 유지됨이 옵저버(Observer)에 의해 자동 확인된 경우.
4. **N/A:**
   - 페이지 내에 사용자가 데이터를 전송하는 입력 서식(Form)이 존재하지 않음.
