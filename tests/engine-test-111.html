<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ABT Processor 1.1.1 (511) Verification Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; background: #f9f9f9; }
        .test-case { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; background: white; border-radius: 8px; }
        .result-box { background: #1e293b; color: #cbd5e1; padding: 15px; white-space: pre-wrap; font-family: monospace; font-size: 11px; border-radius: 4px; margin-top: 10px; max-height: 300px; overflow-y: auto; }
        h1 { color: #1e293b; }
        h2 { font-size: 1.1rem; color: #475569; margin-top: 0; }
        .status-badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .오류 { background: #fee2e2; color: #ef4444; } 
        .수정_권고 { background: #fef3c7; color: #f59e0b; } 
        .검토_필요 { background: #dbeafe; color: #3b82f6; }
        .부적절 { background: #ffedd5; color: #f97316; }
        .적절 { background: #dcfce7; color: #10b981; }
        .description { font-size: 0.9rem; color: #64748b; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>ABT Processor 1.1.1 (511) 검증 테스트</h1>
    <p>KWCAG 2.2 지침 1.1.1 (Non-text Content) 적절한 대체 텍스트 제공 판정 로직을 테스트합니다.</p>

    <div id="test-area">
        <!-- T1: alt 속성 누락 (오류) -->
        <div class="test-case" data-expected="오류">
            <h2>Test 1: alt 속성 누락</h2>
            <p class="description">Rule 1.1 (Missing Alt) 검증</p>
            <img src="https://via.placeholder.com/100" id="t1_img">
        </div>

        <!-- T2: 기능형 요소 내 유일 콘텐츠인데 alt="" (오류) -->
        <div class="test-case" data-expected="오류">
            <h2>Test 2: 기능형 요소 내 alt=""</h2>
            <p class="description">Rule 4.2 (Functional Decorative) 검증. 텍스트가 없는 버튼 안의 이미지가 숨겨짐.</p>
            <button id="t2_btn"><img src="https://via.placeholder.com/20" alt="" id="t2_img"></button>
        </div>

        <!-- T3: 금지어 포함 (수정 권고) -->
        <div class="test-case" data-expected="수정 권고">
            <h2>Test 3: 금지어 포함</h2>
            <p class="description">Rule 2.1 (Forbidden Words) 검증. '사진' 단어 포함.</p>
            <img src="https://via.placeholder.com/100" alt="강아지 사진" id="t3_img">
        </div>

        <!-- T4: 주변 텍스트와 동일 (부적절) -->
        <div class="test-case" data-expected="부적절">
            <h2>Test 4: 주변 정보와 중복</h2>
            <p class="description">Rule 3.1 (High Similarity) 검증. 90% 이상 일치.</p>
            <div id="t4_container">
                <img src="https://via.placeholder.com/100" alt="맛있는 사과" id="t4_img">
                <span>맛있는 사과</span>
            </div>
        </div>

        <!-- T5: 주변 텍스트와 유사 (검토 필요) -->
        <div class="test-case" data-expected="검토 필요">
            <h2>Test 5: 주변 정보와 유사</h2>
            <p class="description">Rule 3.1 (Medium Similarity) 검증. 60% 이상 유사.</p>
            <div id="t5_container">
                <img src="https://via.placeholder.com/100" alt="빨간색 사과" id="t5_img">
                <span>사과가 참 맛있네요</span>
            </div>
        </div>

        <!-- T6: 기능형 이미지 - 적절한 alt (검토 필요) -->
        <div class="test-case" data-expected="검토 필요">
            <h2>Test 6: 기능형 이미지 목적 확인</h2>
            <p class="description">Rule 4.1 (Functional Alt Check) 검증. 대화형 요소 내 이미지는 목적성 수동 확인 유도.</p>
            <a href="#" id="t6_link"><img src="https://via.placeholder.com/20" alt="홈으로 이동" id="t6_img"></a>
        </div>

        <!-- T7: 장식용 이미지 (적절) -->
        <div class="test-case" data-expected="적절">
            <h2>Test 7: 올바른 장식용 처리</h2>
            <p class="description">alt="" 또는 role="presentation" 처리.</p>
            <img src="https://via.placeholder.com/100" alt="" id="t7_img">
            <div role="img" aria-hidden="true" id="t7_div"></div>
        </div>
    </div>

    <hr>
    <div id="log-area"></div>

    <!-- ABT Core 및 모듈 로드 -->
    <script>
        window.ABTConnector = {
            isConnected: true,
            send: (report) => {
                window.testReports = window.testReports || [];
                window.testReports.push(report);
                renderResult(report);
            }
        };
    </script>
    <script src="../src/engine/ABT-Shared-Utils.js"></script>
    <script src="../src/engine/ABT-Core.js"></script>
    <script src="../src/engine/processors/Processor-1.1.1.js"></script>
    
    <script>
        function renderResult(report) {
            const logArea = document.getElementById('log-area');
            const div = document.createElement('div');
            div.className = 'test-case';
            const statusClass = report.result.status.replace(' ', '_');
            
            div.innerHTML = `
                <h3><span class="status-badge ${statusClass}">${report.result.status}</span> [ID: ${report.elementInfo.selector}]</h3>
                <p><strong>Message:</strong> ${report.result.message}</p>
                <p><strong>Rules:</strong> ${report.result.rules.join(', ') || 'N/A'}</p>
                <div class="result-box">${JSON.stringify(report, null, 2)}</div>
            `;
            logArea.appendChild(div);
        }

        window.onload = async () => {
            console.log("ABT: Starting Test Audit...");
            await window.ABTQuickScan();
            console.log("ABT: Test Audit Complete.");
            window.testComplete = true;
        };
    </script>
</body>
</html>
