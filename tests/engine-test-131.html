<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ABT Processor 1.3.1 (Table Structure) Verification Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; background: #f9f9f9; }
        .test-case { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; background: white; border-radius: 8px; }
        .result-box { background: #1e293b; color: #cbd5e1; padding: 15px; white-space: pre-wrap; font-family: monospace; font-size: 11px; border-radius: 4px; margin-top: 10px; max-height: 300px; overflow-y: auto; }
        h1 { color: #1e293b; }
        h2 { font-size: 1.1rem; color: #475569; margin-top: 0; }
        .status-badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .오류 { background: #fee2e2; color: #ef4444; } 
        .수정_권고 { background: #fef3c7; color: #f59e0b; } 
        .적절 { background: #dcfce7; color: #10b981; }
        .description { font-size: 0.9rem; color: #64748b; margin-bottom: 10px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>ABT Processor 1.3.1 (Table Structure) 검증 테스트</h1>
    <p>KWCAG 2.2 지침 1.3.1 (Info and Relationships) 표의 구성 판정 로직을 테스트합니다.</p>

    <div id="test-area">
        <!-- T1: Caption 누락 (오류) -->
        <div class="test-case" data-expected="오류">
            <h2>Test 1: Caption 및 제목 정보 누락</h2>
            <p class="description">Rule 1.1 (Missing Caption) 검증. <caption> 또는 aria-label이 없음.</p>
            <table id="t1_table">
                <tr>
                    <th>이름</th>
                    <th>나이</th>
                </tr>
                <tr>
                    <td>홍길동</td>
                    <td>20</td>
                </tr>
            </table>
        </div>

        <!-- T2: 제목 셀(th) 누락 (오류) -->
        <div class="test-case" data-expected="오류">
            <h2>Test 2: 제목 셀(th) 누락</h2>
            <p class="description">Rule 2.1 (Missing Headers) 검증. 모든 셀이 td로 구성됨.</p>
            <table id="t2_table">
                <caption>사용자 명단</caption>
                <tr>
                    <td>이름</td>
                    <td>나이</td>
                </tr>
                <tr>
                    <td>이순신</td>
                    <td>40</td>
                </tr>
            </table>
        </div>

        <!-- T3: scope 속성 누락 (수정 권고) -->
        <div class="test-case" data-expected="수정 권고">
            <h2>Test 3: th는 있으나 scope 속성 누락</h2>
            <p class="description">Rule 2.2 (Missing Semantic Association) 검증. th에 scope가 없음.</p>
            <table id="t3_table">
                <caption>점수표</caption>
                <tr>
                    <th>과목</th>
                    <th>점수</th>
                </tr>
                <tr>
                    <td>국어</td>
                    <td>90</td>
                </tr>
            </table>
        </div>

        <!-- T4: 레이아웃용 표 (검사 제외) -->
        <div class="test-case" data-expected="N/A (Skipped)">
            <h2>Test 4: 레이아웃용 표 (role="presentation")</h2>
            <p class="description">role="presentation"이 설정된 표는 진단에서 제외되어야 함.</p>
            <table id="t4_table" role="presentation">
                <tr>
                    <td>이것은 데이터가 아닌 레이아웃용입니다.</td>
                </tr>
            </table>
        </div>

        <!-- T5: 정상적인 표 (적절) -->
        <div class="test-case" data-expected="적절">
            <h2>Test 5: 정상적인 데이터 표</h2>
            <p class="description">caption과 scope가 모두 제공됨.</p>
            <table id="t5_table">
                <caption>2024년 매출 현황</caption>
                <thead>
                    <tr>
                        <th scope="col">분기</th>
                        <th scope="col">매출액</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">1분기</th>
                        <td>1,000,000</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <hr>
    <div id="log-area"></div>

    <!-- ABT Core 및 모듈 로드 -->
    <script>
        window.ABTUtils = {
            getSelector: (el) => {
                if (el.id) return `#${el.id}`;
                return el.tagName.toLowerCase();
            },
            getSmartContext: (el, len) => el.outerHTML.substring(0, len),
            isHidden: (el) => false
        };
        window.ABTCore = {
            processors: {},
            registerProcessor: (id, proc) => {
                window.ABTCore.processors[id] = proc;
            }
        };
        window.ABTConnector = {
            isConnected: true,
            send: (report) => {
                renderResult(report);
            }
        };
        window.ABTQuickScan = async () => {
            const proc = window.ABTCore.processors["1.3.1"];
            if (proc) {
                const reports = await proc.scan();
                reports.forEach(r => window.ABTConnector.send(r));
            }
        };
    </script>
    <script src="../src/engine/processors/Processor-131.js"></script>
    
    <script>
        function renderResult(report) {
            const logArea = document.getElementById('log-area');
            const div = document.createElement('div');
            div.className = 'test-case';
            const statusClass = report.result.status.replace(' ', '_');
            
            div.innerHTML = `
                <h3><span class="status-badge ${statusClass}">${report.result.status}</span> [ID: ${report.elementInfo.selector}]</h3>
                <p><strong>Message:</strong> ${report.result.message}</p>
                <p><strong>Rules:</strong> ${report.result.rules.join(', ') || 'N/A'}</p>
                <div class="result-box">${JSON.stringify(report, null, 2)}</div>
            `;
            logArea.appendChild(div);
        }

        window.onload = async () => {
            console.log("ABT: Starting Test Audit...");
            await window.ABTQuickScan();
            console.log("ABT: Test Audit Complete.");
        };
    </script>
</body>
</html>
